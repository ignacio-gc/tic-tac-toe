{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/nacho/prog/next/tic-tac-toe/components/game.js\",\n    _this = this;\n\nimport dynamic from 'next/dynamic';\nimport Board from './board';\nimport { useState, useEffect } from 'react';\nvar Game = dynamic({\n  loader: function () {\n    var _loader = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _s = $RefreshSig$();\n\n      var rustModule;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return import('../pkg');\n\n            case 2:\n              rustModule = _context.sent;\n              return _context.abrupt(\"return\", _s(function (props) {\n                _s();\n\n                var _useState = useState([{\n                  squares: Array(9).fill(null)\n                }]),\n                    history = _useState[0],\n                    setHistory = _useState[1];\n\n                var _useState2 = useState(0),\n                    stepNumber = _useState2[0],\n                    setStepNumber = _useState2[1];\n\n                var _useState3 = useState(true),\n                    xIsNext = _useState3[0],\n                    setXIsNext = _useState3[1];\n\n                var _useState4 = useState(\"\"),\n                    status = _useState4[0],\n                    setStatus = _useState4[1];\n\n                var handleClick = function handleClick(i) {\n                  var hist = history.slice(0, stepNumber + 1);\n                  var current = hist[hist.length - 1];\n                  var squares = current.squares.slice();\n\n                  if (calculateWinner(squares) || squares[i]) {\n                    return;\n                  }\n\n                  squares[i] = xIsNext ? \"X\" : \"O\";\n                  var squares_to_rust = squares.map(function (n) {\n                    return n === null ? String(n) : n;\n                  });\n                  var move = rustModule.solve(squares_to_rust); // set the computer move\n\n                  squares[move] = !xIsNext ? \"X\" : \"O\";\n                  setHistory(hist.concat([{\n                    squares: squares\n                  }]));\n                  setStepNumber(hist.length); // setXIsNext(!xIsNext);\n                };\n\n                var jumpTo = function jumpTo(step) {\n                  setStepNumber(step); // setXIsNext((step % 2) === 0);\n                };\n\n                var moves = history.map(function (step, move) {\n                  var desc = move ? 'Go to move #' + move : 'Go to game start';\n                  return /*#__PURE__*/_jsxDEV(\"li\", {\n                    children: /*#__PURE__*/_jsxDEV(\"button\", {\n                      onClick: function onClick() {\n                        return jumpTo(move);\n                      },\n                      children: desc\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 47,\n                      columnNumber: 15\n                    }, _this)\n                  }, move, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 46,\n                    columnNumber: 13\n                  }, _this);\n                });\n                var current = history[stepNumber];\n                var winner = calculateWinner(current.squares);\n                useEffect(function () {\n                  current = history[stepNumber];\n                  winner = calculateWinner(current.squares);\n\n                  if (winner) {\n                    setStatus(\"Winner: \" + winner);\n                  } else {\n                    setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n                  }\n                });\n\n                var changePlayer = function changePlayer() {\n                  console.log(history.every(function (n) {\n                    return n === null;\n                  }));\n\n                  if (history[length].squares.every(function (n) {\n                    return n === null;\n                  })) {\n                    setXIsNext(!xIsNext);\n                  }\n                };\n\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"game\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"game-board\",\n                    children: /*#__PURE__*/_jsxDEV(Board, {\n                      squares: current.squares,\n                      onClick: function onClick(i) {\n                        return handleClick(i);\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 77,\n                      columnNumber: 15\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 76,\n                    columnNumber: 13\n                  }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"game-info\",\n                    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                      className: \"switch\",\n                      children: [\"Player X?\", /*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"checkbox\",\n                        checked: true,\n                        onChange: function onChange() {\n                          return changePlayer();\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 85,\n                        columnNumber: 17\n                      }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"slider\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 86,\n                        columnNumber: 17\n                      }, _this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 83,\n                      columnNumber: 15\n                    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: status\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 88,\n                      columnNumber: 15\n                    }, _this), /*#__PURE__*/_jsxDEV(\"ol\", {\n                      children: moves\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 89,\n                      columnNumber: 15\n                    }, _this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 82,\n                    columnNumber: 13\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 75,\n                  columnNumber: 11\n                }, _this);\n              }, \"NlRiVKYibOQeRXnBZq9vxhEqmzQ=\"));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function loader() {\n      return _loader.apply(this, arguments);\n    }\n\n    return loader;\n  }(),\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../pkg')];\n    },\n    modules: ['../pkg']\n  }\n});\n\nfunction calculateWinner(squares) {\n  var lines = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];\n\n  for (var i = 0; i < lines.length; i++) {\n    var _lines$i = _slicedToArray(lines[i], 3),\n        a = _lines$i[0],\n        b = _lines$i[1],\n        c = _lines$i[2];\n\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n\n  return null;\n}\n\nexport default Game;","map":{"version":3,"sources":["/home/nacho/prog/next/tic-tac-toe/components/game.js"],"names":["dynamic","Board","useState","useEffect","Game","loader","rustModule","props","squares","Array","fill","history","setHistory","stepNumber","setStepNumber","xIsNext","setXIsNext","status","setStatus","handleClick","i","hist","slice","current","length","calculateWinner","squares_to_rust","map","n","String","move","solve","concat","jumpTo","step","moves","desc","winner","changePlayer","console","log","every","lines","a","b","c"],"mappings":"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","sourcesContent":["import dynamic from 'next/dynamic'\nimport Board from './board'\nimport { useState, useEffect } from 'react'\n\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg')\n\n    return (\n      (props) => {\n        const [history, setHistory] = useState([{ squares: Array(9).fill(null) }]);\n        const [stepNumber, setStepNumber] = useState(0);\n        const [xIsNext, setXIsNext] = useState(true);\n        const [status, setStatus] = useState(\"\");\n\n        const handleClick = (i) => {\n          const hist = history.slice(0, stepNumber + 1);\n          const current = hist[hist.length - 1];\n          const squares = current.squares.slice();\n          if (calculateWinner(squares) || squares[i]) {\n            return;\n          }\n          squares[i] = xIsNext ? \"X\" : \"O\";\n\n          const squares_to_rust = squares.map((n) => n === null ? String(n) : n)\n          const move = rustModule.solve(squares_to_rust)\n          // set the computer move\n          squares[move] = !xIsNext ? \"X\" : \"O\";\n\n          setHistory(hist.concat([{ squares }]));\n          setStepNumber(hist.length);\n          // setXIsNext(!xIsNext);\n        }\n\n        const jumpTo = (step) => {\n          setStepNumber(step);\n          // setXIsNext((step % 2) === 0);\n        }\n\n\n        const moves = history.map((step, move) => {\n          const desc = move ?\n            'Go to move #' + move :\n            'Go to game start';\n          return (\n            <li key={move}>\n              <button onClick={() => jumpTo(move)}>{desc}</button>\n            </li>\n          );\n        });\n\n        let current = history[stepNumber];\n        let winner = calculateWinner(current.squares);\n        useEffect(() => {\n          current = history[stepNumber];\n          winner = calculateWinner(current.squares);\n\n          if (winner) {\n            setStatus(\"Winner: \" + winner);\n          } else {\n            setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n          }\n\n        });\n\n        const changePlayer = () => {\n          console.log(history.every((n) => n === null))\n\n          if (history[length].squares.every((n) => n === null)) {\n            setXIsNext(!xIsNext);\n          }\n        }\n\n        return (\n          <div className=\"game\">\n            <div className=\"game-board\">\n              <Board\n                squares={current.squares}\n                onClick={i => handleClick(i)}\n              />\n            </div>\n            <div className=\"game-info\">\n              <label className=\"switch\">\n                Player X?\n                <input type=\"checkbox\" checked onChange={() => changePlayer()} />\n                <span className=\"slider\"></span>\n              </label>\n              <div>{status}</div>\n              <ol>{moves}</ol>\n            </div>\n          </div >\n        );\n      })\n  },\n})\n\nfunction calculateWinner(squares) {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6]\n  ];\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n  return null;\n}\n\nexport default Game"]},"metadata":{},"sourceType":"module"}