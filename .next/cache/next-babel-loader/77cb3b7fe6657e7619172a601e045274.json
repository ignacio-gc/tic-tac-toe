{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/nacho/prog/next/tic-tac-toe/components/game.js\";\nimport dynamic from 'next/dynamic';\nimport Board from './board';\nimport { useState, useEffect } from 'react';\nimport styles from './game.module.css';\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg');\n    return props => {\n      const {\n        0: history,\n        1: setHistory\n      } = useState([{\n        squares: Array(9).fill(null)\n      }]);\n      const {\n        0: stepNumber,\n        1: setStepNumber\n      } = useState(0);\n      const {\n        0: xIsNext,\n        1: setXIsNext\n      } = useState(true);\n      const {\n        0: status,\n        1: setStatus\n      } = useState(\"\");\n\n      const handleClick = i => {\n        const hist = history.slice(0, stepNumber + 1);\n        const current = hist[hist.length - 1];\n        const squares = current.squares.slice();\n\n        if (calculateWinner(squares) || squares[i]) {\n          return;\n        }\n\n        squares[i] = xIsNext ? \"X\" : \"O\"; // set the computer move\n\n        if (hist.length < 5) {\n          const squares_to_rust = squares.map(n => n === null ? String(n) : n);\n          const move = rustModule.solve(squares_to_rust);\n          squares[move] = !xIsNext ? \"X\" : \"O\";\n        }\n\n        setHistory(hist.concat([{\n          squares\n        }]));\n        setStepNumber(hist.length);\n      };\n\n      const jumpTo = step => {\n        setStepNumber(step);\n      };\n\n      const moves = history.map((step, move) => {\n        const desc = move ? 'Go to move #' + move : 'Go to game start';\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => jumpTo(move),\n            children: desc\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 49,\n            columnNumber: 15\n          }, this)\n        }, move, false, {\n          fileName: _jsxFileName,\n          lineNumber: 48,\n          columnNumber: 13\n        }, this);\n      });\n      let current = history[stepNumber];\n      let winner = calculateWinner(current.squares);\n      useEffect(() => {\n        current = history[stepNumber];\n        winner = calculateWinner(current.squares);\n\n        if (winner) {\n          setStatus(\"Winner: \" + winner);\n        } else {\n          setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n        }\n      });\n\n      const changePlayer = () => {\n        if (stepNumber === 0) {\n          setXIsNext(!xIsNext);\n        }\n      };\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"game\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-board\",\n          children: /*#__PURE__*/_jsxDEV(Board, {\n            squares: current.squares,\n            onClick: i => handleClick(i)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"switch\",\n            children: [\"Player X?\", /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              checked: xIsNext,\n              onChange: () => changePlayer()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 85,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"slider\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 86,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: status\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"ol\", {\n            children: moves\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 11\n      }, this);\n    };\n  },\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('../pkg')],\n    modules: ['../pkg']\n  }\n});\n\nfunction calculateWinner(squares) {\n  const lines = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];\n\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n\n  return null;\n}\n\nexport default Game;","map":{"version":3,"sources":["/home/nacho/prog/next/tic-tac-toe/components/game.js"],"names":["dynamic","Board","useState","useEffect","styles","Game","loader","rustModule","props","history","setHistory","squares","Array","fill","stepNumber","setStepNumber","xIsNext","setXIsNext","status","setStatus","handleClick","i","hist","slice","current","length","calculateWinner","squares_to_rust","map","n","String","move","solve","concat","jumpTo","step","moves","desc","winner","changePlayer","lines","a","b","c"],"mappings":"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","sourcesContent":["import dynamic from 'next/dynamic'\nimport Board from './board'\nimport { useState, useEffect } from 'react'\nimport styles from './game.module.css'\n\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg')\n\n    return (\n      (props) => {\n        const [history, setHistory] = useState([{ squares: Array(9).fill(null) }]);\n        const [stepNumber, setStepNumber] = useState(0);\n        const [xIsNext, setXIsNext] = useState(true);\n        const [status, setStatus] = useState(\"\");\n\n        const handleClick = (i) => {\n          const hist = history.slice(0, stepNumber + 1);\n          const current = hist[hist.length - 1];\n          const squares = current.squares.slice();\n          if (calculateWinner(squares) || squares[i]) {\n            return;\n          }\n\n          squares[i] = xIsNext ? \"X\" : \"O\";\n\n          // set the computer move\n          if (hist.length < 5) {\n            const squares_to_rust = squares.map((n) => n === null ? String(n) : n)\n            const move = rustModule.solve(squares_to_rust)\n            squares[move] = !xIsNext ? \"X\" : \"O\";\n          } \n\n          setHistory(hist.concat([{ squares }]));\n          setStepNumber(hist.length);\n        }\n\n        const jumpTo = (step) => {\n          setStepNumber(step);\n        }\n\n\n        const moves = history.map((step, move) => {\n          const desc = move ?\n            'Go to move #' + move :\n            'Go to game start';\n          return (\n            <li key={move}>\n              <button onClick={() => jumpTo(move)}>{desc}</button>\n            </li>\n          );\n        });\n\n        let current = history[stepNumber];\n        let winner = calculateWinner(current.squares);\n        useEffect(() => {\n          current = history[stepNumber];\n          winner = calculateWinner(current.squares);\n\n          if (winner) {\n            setStatus(\"Winner: \" + winner);\n          } else {\n            setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n          }\n\n        });\n\n        const changePlayer = () => {\n          if (stepNumber === 0) {\n            setXIsNext(!xIsNext);\n          }\n        }\n\n        return (\n          <div className=\"game\">\n            <div className=\"game-board\">\n              <Board\n                squares={current.squares}\n                onClick={i => handleClick(i)}\n              />\n            </div>\n            <div className=\"game-info\">\n              <label className=\"switch\">\n                Player X?\n                <input type=\"checkbox\" checked={xIsNext} onChange={() => changePlayer()} />\n                <span className=\"slider\"></span>\n              </label>\n              <div>{status}</div>\n              <ol>{moves}</ol>\n            </div>\n          </div >\n        );\n      })\n  },\n})\n\nfunction calculateWinner(squares) {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6]\n  ];\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n  return null;\n}\n\nexport default Game"]},"metadata":{},"sourceType":"module"}