{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/nacho/prog/next/tic-tac-toe/components/game.js\";\nimport dynamic from 'next/dynamic';\nimport Board from './board';\nimport { useState, useEffect } from 'react';\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg');\n    return props => {\n      const {\n        0: history,\n        1: setHistory\n      } = useState([{\n        squares: Array(9).fill(null)\n      }]);\n      const {\n        0: stepNumber,\n        1: setStepNumber\n      } = useState(0);\n      const {\n        0: xIsNext,\n        1: setXIsNext\n      } = useState(true);\n      const {\n        0: status,\n        1: setStatus\n      } = useState(\"\");\n\n      const handleClick = i => {\n        const hist = history.slice(0, stepNumber + 1);\n        console.log(\"hist: \" + hist);\n        const current = hist[hist.length - 1];\n        const squares = current.squares.slice();\n\n        if (calculateWinner(squares) || squares[i]) {\n          return;\n        }\n\n        squares[i] = xIsNext ? \"X\" : \"O\";\n        const squares_to_rust = squares.map(n => n === null ? String(n) : n);\n        const move = rustModule.solve(squares_to_rust); // set the computer move\n\n        squares[move] = !xIsNext ? \"X\" : \"O\";\n        setHistory(hist.concat([{\n          squares\n        }]));\n        setStepNumber(hist.length);\n        setXIsNext(!xIsNext);\n      };\n\n      const jumpTo = step => {\n        setStepNumber(step);\n        setXIsNext(step % 2 === 0);\n      };\n\n      const moves = history.map((step, move) => {\n        const desc = move ? 'Go to move #' + move : 'Go to game start';\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => jumpTo(move),\n            children: desc\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 48,\n            columnNumber: 15\n          }, this)\n        }, move, false, {\n          fileName: _jsxFileName,\n          lineNumber: 47,\n          columnNumber: 13\n        }, this);\n      });\n      let current = history[stepNumber];\n      let winner = calculateWinner(current.squares);\n      useEffect(() => {\n        current = history[stepNumber];\n        winner = calculateWinner(current.squares);\n\n        if (winner) {\n          setStatus(\"Winner: \" + winner);\n        } else {\n          setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n        }\n      });\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"game\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-board\",\n          children: /*#__PURE__*/_jsxDEV(Board, {\n            squares: current.squares,\n            onClick: i => handleClick(i)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 71,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: status\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"ol\", {\n            children: moves\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 11\n      }, this);\n    };\n  },\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('../pkg')],\n    modules: ['../pkg']\n  }\n});\n\nfunction calculateWinner(squares) {\n  const lines = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];\n\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n\n  return null;\n}\n\nexport default Game;","map":{"version":3,"sources":["/home/nacho/prog/next/tic-tac-toe/components/game.js"],"names":["dynamic","Board","useState","useEffect","Game","loader","rustModule","props","history","setHistory","squares","Array","fill","stepNumber","setStepNumber","xIsNext","setXIsNext","status","setStatus","handleClick","i","hist","slice","console","log","current","length","calculateWinner","squares_to_rust","map","n","String","move","solve","concat","jumpTo","step","moves","desc","winner","lines","a","b","c"],"mappings":"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","sourcesContent":["import dynamic from 'next/dynamic'\nimport Board from './board'\nimport { useState, useEffect } from 'react'\n\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg')\n\n    return (\n      (props) => {\n        const [history, setHistory] = useState([{ squares: Array(9).fill(null) }]);\n        const [stepNumber, setStepNumber] = useState(0);\n        const [xIsNext, setXIsNext] = useState(true);\n        const [status, setStatus] = useState(\"\");\n\n        const handleClick = (i) => {\n          const hist = history.slice(0, stepNumber + 1);\n          console.log(\"hist: \" + hist)\n          const current = hist[hist.length - 1];\n          const squares = current.squares.slice();\n          if (calculateWinner(squares) || squares[i]) {\n            return;\n          }\n          squares[i] = xIsNext ? \"X\" : \"O\";\n\n          const squares_to_rust = squares.map((n) => n === null ? String(n) : n)\n          const move = rustModule.solve(squares_to_rust)\n          // set the computer move\n          squares[move] = !xIsNext ? \"X\" : \"O\";\n\n          setHistory(hist.concat([{ squares }]));\n          setStepNumber(hist.length);\n          setXIsNext(!xIsNext);\n        }\n\n        const jumpTo = (step) => {\n          setStepNumber(step);\n          setXIsNext((step % 2) === 0);\n        }\n\n\n        const moves = history.map((step, move) => {\n          const desc = move ?\n            'Go to move #' + move :\n            'Go to game start';\n          return (\n            <li key={move}>\n              <button onClick={() => jumpTo(move)}>{desc}</button>\n            </li>\n          );\n        });\n\n        let current = history[stepNumber];\n        let winner = calculateWinner(current.squares);\n        useEffect(() => {\n          current = history[stepNumber];\n          winner = calculateWinner(current.squares);\n\n          if (winner) {\n            setStatus(\"Winner: \" + winner);\n          } else {\n            setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n          }\n\n        });\n\n\n        return (\n          <div className=\"game\">\n            <div className=\"game-board\">\n              <Board\n                squares={current.squares}\n                onClick={i => handleClick(i)}\n              />\n            </div>\n            <div className=\"game-info\">\n              <div>{status}</div>\n              <ol>{moves}</ol>\n            </div>\n          </div>\n        );\n      })\n  },\n})\n\nfunction calculateWinner(squares) {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6]\n  ];\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n  return null;\n}\n\nexport default Game"]},"metadata":{},"sourceType":"module"}