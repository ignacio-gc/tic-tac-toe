{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/nacho/prog/next/tic-tac-toe/components/game.js\";\nimport dynamic from 'next/dynamic';\nimport Board from './board';\nimport { useState, useEffect } from 'react';\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg');\n    return props => {\n      const {\n        0: history,\n        1: setHistory\n      } = useState([{\n        squares: Array(9).fill(null)\n      }]);\n      const {\n        0: stepNumber,\n        1: setStepNumber\n      } = useState(0);\n      const {\n        0: xIsNext,\n        1: setXIsNext\n      } = useState(true);\n      const {\n        0: status,\n        1: setStatus\n      } = useState(\"\");\n\n      const handleClick = i => {\n        const hist = history.slice(0, stepNumber + 1);\n        const current = hist[hist.length - 1];\n        const squares = current.squares.slice();\n\n        if (calculateWinner(squares) || squares[i]) {\n          return;\n        }\n\n        squares[i] = xIsNext ? \"X\" : \"O\";\n        console.log(squares.map(n => n === null ? String(n) : n)); // set the computer move\n        // squares[move] = !xIsNext ? \"X\" : \"O\";\n\n        setHistory(hist.concat([{\n          squares\n        }]));\n        setStepNumber(hist.length);\n        setXIsNext(!xIsNext);\n      };\n\n      const jumpTo = step => {\n        setStepNumber(step);\n        setXIsNext(step % 2 === 0);\n      };\n\n      const moves = history.map((step, move) => {\n        const desc = move ? 'Go to move #' + move : 'Go to game start';\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => jumpTo(move),\n            children: desc\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 46,\n            columnNumber: 15\n          }, this)\n        }, move, false, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 13\n        }, this);\n      });\n      let current = history[stepNumber];\n      let winner = calculateWinner(current.squares);\n      useEffect(() => {\n        current = history[stepNumber];\n        winner = calculateWinner(current.squares);\n\n        if (winner) {\n          setStatus(\"Winner: \" + winner);\n        } else {\n          setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n        }\n      });\n      const init = rustModule.initial_state_to_js();\n      const serde = rustModule.number();\n      const arr = [\"X\", null, null, \"X\", null, null, null, null, null];\n      const solve = rustModule.solve(arr.map(n => n === null ? String(n) : n));\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"game\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-board\",\n          children: /*#__PURE__*/_jsxDEV(Board, {\n            squares: current.squares,\n            onClick: i => handleClick(i)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: status\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"ol\", {\n            children: moves\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Init: \", init.board.map((n, idx) => ' ' + n + idx + ' ')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: solve\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 11\n      }, this);\n    };\n  },\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('../pkg')],\n    modules: ['../pkg']\n  }\n});\n\nfunction calculateWinner(squares) {\n  const lines = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];\n\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n\n  return null;\n}\n\nexport default Game;","map":{"version":3,"sources":["/home/nacho/prog/next/tic-tac-toe/components/game.js"],"names":["dynamic","Board","useState","useEffect","Game","loader","rustModule","props","history","setHistory","squares","Array","fill","stepNumber","setStepNumber","xIsNext","setXIsNext","status","setStatus","handleClick","i","hist","slice","current","length","calculateWinner","console","log","map","n","String","concat","jumpTo","step","moves","move","desc","winner","init","initial_state_to_js","serde","number","arr","solve","board","idx","lines","a","b","c"],"mappings":"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","sourcesContent":["import dynamic from 'next/dynamic'\nimport Board from './board'\nimport { useState, useEffect } from 'react'\n\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg')\n\n    return (\n      (props) => {\n        const [history, setHistory] = useState([{ squares: Array(9).fill(null) }]);\n        const [stepNumber, setStepNumber] = useState(0);\n        const [xIsNext, setXIsNext] = useState(true);\n        const [status, setStatus] = useState(\"\");\n\n        const handleClick = (i) => {\n          const hist = history.slice(0, stepNumber + 1);\n          const current = hist[hist.length - 1];\n          const squares = current.squares.slice();\n          if (calculateWinner(squares) || squares[i]) {\n            return;\n          }\n          squares[i] = xIsNext ? \"X\" : \"O\";\n          console.log(squares.map((n) => n === null ? String(n) : n))\n\n          // set the computer move\n          // squares[move] = !xIsNext ? \"X\" : \"O\";\n\n          setHistory(hist.concat([{ squares }]));\n          setStepNumber(hist.length);\n          setXIsNext(!xIsNext);\n        }\n\n        const jumpTo = (step) => {\n          setStepNumber(step);\n          setXIsNext((step % 2) === 0);\n        }\n\n\n        const moves = history.map((step, move) => {\n          const desc = move ?\n            'Go to move #' + move :\n            'Go to game start';\n          return (\n            <li key={move}>\n              <button onClick={() => jumpTo(move)}>{desc}</button>\n            </li>\n          );\n        });\n\n        let current = history[stepNumber];\n        let winner = calculateWinner(current.squares);\n        useEffect(() => {\n          current = history[stepNumber];\n          winner = calculateWinner(current.squares);\n\n          if (winner) {\n            setStatus(\"Winner: \" + winner);\n          } else {\n            setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n          }\n\n        });\n\n        const init = rustModule.initial_state_to_js()\n        const serde = rustModule.number()\n        const arr = [\"X\", null, null, \"X\", null, null, null, null, null]\n        const solve = rustModule.solve(arr.map((n) => n === null ? String(n) : n))\n\n        return (\n          <div className=\"game\">\n            <div className=\"game-board\">\n              <Board\n                squares={current.squares}\n                onClick={i => handleClick(i)}\n              />\n            </div>\n            <div className=\"game-info\">\n              <div>{status}</div>\n              <ol>{moves}</ol>\n              <div>Init: {init.board.map((n, idx) => ' ' + n + idx + ' ')}</div>\n              <div>{solve}</div>\n            </div>\n          </div>\n        );\n      })\n  },\n})\n\nfunction calculateWinner(squares) {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6]\n  ];\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n  return null;\n}\n\nexport default Game"]},"metadata":{},"sourceType":"module"}