{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/nacho/prog/next/tic-tac-toe/components/game.js\",\n    _this = this;\n\nimport dynamic from 'next/dynamic';\nimport Board from './board';\nimport { useState, useEffect } from 'react';\nvar Game = dynamic({\n  loader: function () {\n    var _loader = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _s = $RefreshSig$();\n\n      var rustModule;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return import('../pkg');\n\n            case 2:\n              rustModule = _context.sent;\n              return _context.abrupt(\"return\", _s(function (props) {\n                _s();\n\n                var _useState = useState([{\n                  squares: Array(9).fill(null)\n                }]),\n                    history = _useState[0],\n                    setHistory = _useState[1];\n\n                var _useState2 = useState(0),\n                    stepNumber = _useState2[0],\n                    setStepNumber = _useState2[1];\n\n                var _useState3 = useState(true),\n                    xIsNext = _useState3[0],\n                    setXIsNext = _useState3[1];\n\n                var _useState4 = useState(\"\"),\n                    status = _useState4[0],\n                    setStatus = _useState4[1];\n\n                var handleClick = function handleClick(i) {\n                  var hist = history.slice(0, stepNumber + 1);\n                  console.log(\"hist: \" + hist);\n                  var current = hist[hist.length - 1];\n                  var squares = current.squares.slice();\n\n                  if (calculateWinner(squares) || squares[i]) {\n                    return;\n                  }\n\n                  squares[i] = xIsNext ? \"X\" : \"O\";\n                  var squares_to_rust = squares.map(function (n) {\n                    return n === null ? String(n) : n;\n                  });\n                  var move = rustModule.solve(squares_to_rust); // set the computer move\n\n                  squares[move] = !xIsNext ? \"X\" : \"O\";\n                  setHistory(hist.concat([{\n                    squares: squares\n                  }]));\n                  setStepNumber(hist.length);\n                  setXIsNext(!xIsNext);\n                };\n\n                var jumpTo = function jumpTo(step) {\n                  setStepNumber(step);\n                  setXIsNext(step % 2 === 0);\n                };\n\n                var moves = history.map(function (step, move) {\n                  var desc = move ? 'Go to move #' + move : 'Go to game start';\n                  return /*#__PURE__*/_jsxDEV(\"li\", {\n                    children: /*#__PURE__*/_jsxDEV(\"button\", {\n                      onClick: function onClick() {\n                        return jumpTo(move);\n                      },\n                      children: desc\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 48,\n                      columnNumber: 15\n                    }, _this)\n                  }, move, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 47,\n                    columnNumber: 13\n                  }, _this);\n                });\n                var current = history[stepNumber];\n                var winner = calculateWinner(current.squares);\n                useEffect(function () {\n                  current = history[stepNumber];\n                  winner = calculateWinner(current.squares);\n\n                  if (winner) {\n                    setStatus(\"Winner: \" + winner);\n                  } else {\n                    setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n                  }\n                });\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"game\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"game-board\",\n                    children: /*#__PURE__*/_jsxDEV(Board, {\n                      squares: current.squares,\n                      onClick: function onClick(i) {\n                        return handleClick(i);\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 71,\n                      columnNumber: 15\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 70,\n                    columnNumber: 13\n                  }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"game-info\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      children: status\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 77,\n                      columnNumber: 15\n                    }, _this), /*#__PURE__*/_jsxDEV(\"ol\", {\n                      children: moves\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 78,\n                      columnNumber: 15\n                    }, _this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 76,\n                    columnNumber: 13\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 69,\n                  columnNumber: 11\n                }, _this);\n              }, \"NlRiVKYibOQeRXnBZq9vxhEqmzQ=\"));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function loader() {\n      return _loader.apply(this, arguments);\n    }\n\n    return loader;\n  }(),\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../pkg')];\n    },\n    modules: ['../pkg']\n  }\n});\n\nfunction calculateWinner(squares) {\n  var lines = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];\n\n  for (var i = 0; i < lines.length; i++) {\n    var _lines$i = _slicedToArray(lines[i], 3),\n        a = _lines$i[0],\n        b = _lines$i[1],\n        c = _lines$i[2];\n\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n\n  return null;\n}\n\nexport default Game;","map":{"version":3,"sources":["/home/nacho/prog/next/tic-tac-toe/components/game.js"],"names":["dynamic","Board","useState","useEffect","Game","loader","rustModule","props","squares","Array","fill","history","setHistory","stepNumber","setStepNumber","xIsNext","setXIsNext","status","setStatus","handleClick","i","hist","slice","console","log","current","length","calculateWinner","squares_to_rust","map","n","String","move","solve","concat","jumpTo","step","moves","desc","winner","lines","a","b","c"],"mappings":"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","sourcesContent":["import dynamic from 'next/dynamic'\nimport Board from './board'\nimport { useState, useEffect } from 'react'\n\nconst Game = dynamic({\n  loader: async () => {\n    const rustModule = await import('../pkg')\n\n    return (\n      (props) => {\n        const [history, setHistory] = useState([{ squares: Array(9).fill(null) }]);\n        const [stepNumber, setStepNumber] = useState(0);\n        const [xIsNext, setXIsNext] = useState(true);\n        const [status, setStatus] = useState(\"\");\n\n        const handleClick = (i) => {\n          const hist = history.slice(0, stepNumber + 1);\n          console.log(\"hist: \" + hist)\n          const current = hist[hist.length - 1];\n          const squares = current.squares.slice();\n          if (calculateWinner(squares) || squares[i]) {\n            return;\n          }\n          squares[i] = xIsNext ? \"X\" : \"O\";\n\n          const squares_to_rust = squares.map((n) => n === null ? String(n) : n)\n          const move = rustModule.solve(squares_to_rust)\n          // set the computer move\n          squares[move] = !xIsNext ? \"X\" : \"O\";\n\n          setHistory(hist.concat([{ squares }]));\n          setStepNumber(hist.length);\n          setXIsNext(!xIsNext);\n        }\n\n        const jumpTo = (step) => {\n          setStepNumber(step);\n          setXIsNext((step % 2) === 0);\n        }\n\n\n        const moves = history.map((step, move) => {\n          const desc = move ?\n            'Go to move #' + move :\n            'Go to game start';\n          return (\n            <li key={move}>\n              <button onClick={() => jumpTo(move)}>{desc}</button>\n            </li>\n          );\n        });\n\n        let current = history[stepNumber];\n        let winner = calculateWinner(current.squares);\n        useEffect(() => {\n          current = history[stepNumber];\n          winner = calculateWinner(current.squares);\n\n          if (winner) {\n            setStatus(\"Winner: \" + winner);\n          } else {\n            setStatus(\"Next player: \" + (xIsNext ? \"X\" : \"O\"));\n          }\n\n        });\n\n\n        return (\n          <div className=\"game\">\n            <div className=\"game-board\">\n              <Board\n                squares={current.squares}\n                onClick={i => handleClick(i)}\n              />\n            </div>\n            <div className=\"game-info\">\n              <div>{status}</div>\n              <ol>{moves}</ol>\n            </div>\n          </div>\n        );\n      })\n  },\n})\n\nfunction calculateWinner(squares) {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6]\n  ];\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n  return null;\n}\n\nexport default Game"]},"metadata":{},"sourceType":"module"}